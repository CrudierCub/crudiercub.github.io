[
  
  {
    "title": "Hackig a servidores de Minecraft",
    "url": "/posts/Hacking-a-Servidores-de-Minecraft/",
    "categories": "Hacking, Minecraft",
    "tags": "hacking, minecraft",
    "date": "2023-10-24 00:00:00 -0600",
    





    
    "snippet": "Buenaass, en este post estaremos hablando y explotando una vulnerabilidad conocida como Bungee Exploit la cual nos permite burlar la seguridad de una Network. A pesar de queesta vulnerabilidad es m...",
    "content": "Buenaass, en este post estaremos hablando y explotando una vulnerabilidad conocida como Bungee Exploit la cual nos permite burlar la seguridad de una Network. A pesar de queesta vulnerabilidad es muy antigua, sigue funcionando y no hay mucha información sobre ella, por lo que explicare sobre como funciona y como explotarla.¿Qué es el Bungee Exploit?El Bungee Exploit es una vulnerabilidad en las versiones BungeeCoord y Velocity,estas versiones son usadas para crear una Network la cual conecta varios servidores de Minecraft entre si, Esta vulnerabilidad consiste conectarse directamente a un servidor evadiendo la verificación de la Network¿Cómo funciona?La vulneravilidad es posible ya que los servidores conectados al Bugeecord o Velocity unicamente verifican que el usuario se conecte primero a una proxy (no necesariamente al Bungeecord o Velocity propio) y luego al servidor de MinecraftExplotacionDescargando herramientasPara explotar esta vulnerabilidad usaremos una herramienta llamada MCPTooldesarollada por wrrulos. Esta herramienta crea una proxy la cualredirige nuestra conexión al servidor vulnerable que queremos entrarPara descargrla desde GitHub debemos usar el siguiente comando:git clone https://github.com/wrrulos/MCPTool.git &amp;&amp; cd MCPToolInstalando dependenciasAhora debemos instalar las dependencias de la herramienta, para ello usaremos el siguiente comando:python3 setup.pyIntalando PythonEn caso de que no tengas python instalado o prefieres realizar una instalacion manual, puedesseguir los siguiente pasos:Para instalar Python en Windows debes descargarlo desde la página oficial:https://www.python.org/Para instalar Python en Linux, puede usar el siguiente comando:sudo apt install python3-pipInstalando NodeJSPara instalar NodeJS en Windows debes descargarlo desde la página oficial:https://nodejs.org/es/Para instalar NodeJS en Linux, puede usar el siguiente comando:sudo apt install nodejs -y &amp;&amp; sudo apt install npm -yInstalando Java 17Para instalar Java 17 en Windows debes descargarlo desde la página oficial:https://www.oracle.com/java/technologies/javase/jdk17-archive-downloads.htmlPara instalar Java 17 en Linux, puede usar el siguiente comando:sudo apt install openjdk-17-jdk openjdk-17-jreInstalando NmapPara instalar Nmap en Windows debes descargarlo desde la página oficial:https://nmap.org/download.htmlPara instalar Nmap en Linux, puede usar el siguiente comando:sudo apt-get install nmapInstalando NgrokPara instalar Ngrok en Windows debes descargarlo desde la página oficial:https://ngrok.com/downloadPara instalar Ngrok en Linux, puede usar el siguiente comando:curl -s https://ngrok-agent.s3.amazonaws.com/ngrok.asc | sudo tee /etc/apt/trusted.gpg.d/ngrok.asc &gt;/dev/null &amp;&amp; echo \"deb https://ngrok-agent.s3.amazonaws.com buster main\" | sudo tee /etc/apt/sources.list.d/ngrok.list &amp;&amp; sudo apt update &amp;&amp; sudo apt install ngrokUsando la herramientaAhora que tenemos todo lo necesario para usar la herramienta, podemos ejecutarla usando el siguiente comando para iniciarla:python3 main.pyUna vez iniciada la herramienta, comprobara que todas las dependencias esten instaladas, en caso de que no lo esten, puedes repetir los pasos anteriores para instalarlasEscaneando el servidorAhora que tenemos la herramienta iniciada, debemos escanear el servidor donde estamos realizando las pruebas, para eso debemos obtener la direccion IP numerica con el comandoserver, como se muestra en la siguiente imagen:Ahora que sabemos que el servidor utiliza Bungeecord (informacion que nos servira despues) y que la direccion IP es 212.193.3.96, despues debemos escanear el servidor con el comando scan &lt; ip &gt; &lt; puertos &gt; &lt; escaner &gt; &lt; bot &gt;. Antes de usar el comandoexplica cada uno de los parametros:IPIngresa un rango de IP’s numericas como 127.0.0.1-255Ingresa una IP numerica como 127.0.0.1Rango de puertosIngresa un unico puerto como 25565Ingresa un rango de puertos como 25565-25585EscanerPuedes realizar el escaneo utilizando diferentes escanersEscaners validos:  nmap (0)  Quboscanner (1)  Masscan (2)Este parametro acepta tanto el nombre como el numero del escanerBotAqui debes ingresar y (yes) o n (no) dependiendo si quieres que un bot se conecte al servidorSiguiendo con el escaneoAhora que sabemos que es lo que hace el comando y que significa cada parametro, podemos continuarcon el escaneo del servidorEl resultado del escaneo nos muestra que se encontro un servidor en el puerto 25575 y otro, Recordemoso que el servidor usa Bungeecord como vimos al usar el comando server, Pero ahora en el apartado checker nos muestra que el servidor es vulnerable a Bungee ExploitPor esta razon es util usar “y” en el parametro bot, para comprobar si el servidor es vulnerableo no y tener una lista de los usuarios conectados y su UUID que nos servira despues  Yo ya conocia la ip y puerto del servidor desde antes del escaneo, pero el comando scan te puede revelar esta informacionCreando la proxyPara crear el servidor proxy que redirigira nuestra conexion al servidor especificado, tenemos 2comandos disponibles: Waterfall y Velocity, que corresponden a Bungeecord y Velocity respectivamente, si conoces si el servidor usa BungeeCord o Velocity, puedes usar el comando correspondiente, de lo contraria puedes intentar con los 2 comandos hasta que alguno funcione.Ambos comandos funcionan de la misma manera, pero Velocity tiene un parametro extra el cual es &lt; forwarding-mode &gt; el cual tienes los siguientes modos validos:  none  legacy  BungeeCord  BungeeGuardEsta opcion depende mas que nada de la confguracion del servidor, pero esa informacion no la tenemos, por lo tanto para poder saber que modo usar, puedes probar con cada una delas opciones hasta que alguna te funcioneEn mi caso usare el comando Waterfall ya que al momento de hacer el escaneo, se encontroque el servidor usa BungeecordConectandonos al servidorDespues de haber creado un servidor en el puerto 25570 de nuestro localhost, ahorapodemos conectarnos a esa direccion para ser redirigido al servidor que especificamosComo podemos ver, nos conectamos al servidor y nos redirigio al servidor especificado, evitando elmensaje “If you wish IP fowarding, please enable it in your BungeeCord config as well!” que nosaparce si nos intentamos conectar directamente al servidor sin seguir los pasos anterioresAhora que estamos conectados al servidor, lo mas probable es que nos pida iniciar sesion o registrarnosya que el servidor puede contar con plugins de autenticacion, el plugin mas usando es AuthMe y lo mas probable es que nocoozcas la contraseña de ningun usuario, por lo que ahora veremos como burlar la autenticacionSi al conectarte al servidor, no te pide ninguna contraseña, felicidades, lo mas probable esque hayas entrado a una network premium, asi que ahora puedes ver como conseguir permisos de administradorUUID SpoofNormalmente los servidores y plugins no toman en cuenta el Nickname, sino que utilizanel UUID (Universally Unique Identifier) del usuario para identificarlo, este UUID puede sermodificado y simular ser otro usuario sin afectar nuesto Nickname, lo que sera util paraburlar el plugin de autenticacionPara obtener el UUID de un jugador, podemos usar el comando player &lt; username &gt; (en otra ventanapara no cerrar la proxy anteriormente creada) el cual nos dara la informacion que buscamosAhora que tenemos el UUID de un usuario admin, podemos usar el comando el comando /set-uuid &lt; uuid &gt; para cambiar nuestro UUID por el del administrador del servidorDespues de utilizar el comando, podemos volver a conectarnos al servidor proxy (sin apagarlo) y ahora toda nuestrainformacion como posicion, inventario, rango, etc. sera la del usuario admin y no la nuestra, sin embargo nosotros seguimos con nuestro Nickname y no el del adminComo nuestro nickname no cambio, el plugin de autenticacion nos pedira iniciar sesioncomo si fuera nuestra cuenta y no la del admin, pero como nuestro UUID es la del admin,tendremos los permisos de el y podremos hacer lo que queramos en el servidorRecomiendo darle op a una cuenta alterna ya que si te das op a ti mismo, el servidorte dira que el usurio ya es op, debido a que el servidor guarda el UUID y Nickname delos usuarios con op, y recordemos que estamos usando el UUID del admin y no el nuestro,es por esto que nos aparecera ese mensaje y debemos usar una cuenta alterna para darnos opArreglando la vulnerabilidadBungeeCordPara arreglar esta vulnerabilidad, es tan facil como instalar el plugin BungeeGuard en BungeeCord, este plugin evita que los usuarios se conecten directamente a los servidores y solo puedan conectarse a traves de nuestra proxy, pidiendo un token de autenticacion en todos los servidores, el cual solo se puede obtener al conectarse a la proxy del servidorUna vez instalado el plugin, debemos dirigirnos al archivo /plugins/BungeeGuard/token.ymly apuntar el token que aparece en el archivo, ya que lo necesitaremos para las configuracionesVelocityAsegurate de tener instalada la version Velocity 1.1.0 o superior, ya que a partir de estaversion, velocity viene con BungeeGuard incluido y no necesitas instalarloPon “bungeeguard” en player-info-forwarding-mode en el archivo velocity.toml y guarda elforwarding-secret ya que este es el token que necesitaremos para las configuraciones y luego reincia la proxyEn los servidores  Verifica que estes usando Paper 1.9.4+ o tener ProtocolLib instalado  Asegurate de tener bungeecord puesto en true en el archivo spigot.yml  Agrega el archivo BungeeGuard.jar en la carpeta /plugins y reincia el servidor  Ve al archivo /plugins/BungeeGuard/config.yml y agrega los tokens a la lista allowed-tokens # Allowed authentication tokens.  allowed-tokens:  - \"AUSXEwebkOGVnbihJM8gBS0QUutDzvIG009xoAfo1Huba9pGvhfjrA21r8dWVsa8\"  Reinicia el servidor  Debes realizar esta configuracion en todos los servidores Spigot o Paper conectados a la NetworkCon estas configuraciones tu servidor ahora esta protegido contra el Bungee Exploit yno deberias tener problemas con usuarios que se conecten directamente a los servidoresConclusiónEsta vulnerabilidad es muy antigua y no hay mucha informacion sobre ella, pero sigue funcionandoen muchisimos servidores, por lo que es importante que los administradores de servidores esten informados sobre este tipo de vulnerabilidades y como solucionarlas, ya que es muy facil deexplotar y puede causar muchos problemas en los servidores  Al momento de publicar este post, el error ya fue arreglado en el servidor que use para las pruebasQuiero agradecer a Leyend Network por permitirme realizar las pruebas en su servidor y dejarme publicar este post con la informacion de su servidor, si quieres jugar en su servidorla ip para conectarse es leyend.servermc.xyzCon esto me despido, espero que les haya gustado este post y les haya sido util, para informarsey de ser necesario, arreglar el problema para proteger su Network"
  }
  
]

